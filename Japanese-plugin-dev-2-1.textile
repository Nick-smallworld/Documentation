h1. ファンクションタグ プラグインの開発について

h2. はじめに

今回は既に「第５回】テストドリブンでのプラグインの開発について」で紹介しているファンクションタグについて、改めて解説させていただきます。

h2. ファンクションタグとは？

ファンクションタグとは、タグの内部処理を行い、その結果をブログ記事やウェブページなどに出力するものです。

前回のファンクションタグ"&lt;MTHelloWorld&gt;"は、特に処理をせず毎回"Hello, world!"を出力するだけの物でしたが、今回はデータベース処理なども含めて解説します。

h2. プラグインの仕様とテストケースの作成

h3. 仕様の策定

仕様としては以下を満たす実装を行います。

* システムのプラグイン設定画面での表示
** プラグイン名：「サンプルプラグイン ファンクションタグ 1.0」
** 詳細：「ファンクションタグ テストプラグイン」
** 詳細＞ドキュメント：「http://www.example.com/docs/」
** 詳細＞プラグイン作者：「http://www.example.com/about/」
** リソース：「タグ：&lt;$MTCSSByCategory$&gt;」
* ブログ記事アーカイブのテンプレートの<head>に"&lt;MTCSSByCategory&gt;"タグを追加するだけ
* ブログ記事にカテゴリが無い場合は、何も出力しない
* ブログ記事にカテゴリがある場合は以下の処理をする
** カテゴリの親子関係を確認する
** 親カテゴリの場合は、"cat-（$category-&gt;basename）"というフォルダ名を作成する
** 親カテゴリがある場合は、"cat-（$parent-&t;basename）-（$category-&gt;basename）"というフォルダ名を作成する
** 親子関係は孫や孫の子など階層に制限無し
** このフォルダ名から、CSS名をmt-confing.cgiに設定されているStaticWebPath配下のファイルとヒモ付けます
*** mt-config.cgiに設定されているStaticWebPath配下の"support"ディレクトリ以下のCSSにひもづける　例）"/mt-static/support/css/cat-foo-subfoo/screen.css"
** cssファイルを配置するHTMLタグを出力する　"&lt;link rel="stylesheet" href="/mt-static/support/css/cat-foo-subfoo/screen.css" type="text/css" /&gt;"
* 書き込まれたCSSファイルのパスにCSSを配置すると、CSSの要素が新設や上書きされる
* このタグはブログ記事アーカイブ以外、例えばカテゴリアーカイブなどでは動作せずエラーとなります。

h3. テスト環境の準備

"$MT_DIR/t/mysql-test.cfg"に以下の一行を追加


